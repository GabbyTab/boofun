

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>boofun.utils.number_theory &mdash; BooFun 1.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=6efca38a"></script>
      <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            BooFun
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/spectral_analysis.html">Spectral Analysis Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/query_complexity.html">Query Complexity Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/hypercontractivity.html">Hypercontractivity Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/cryptographic.html">Cryptographic Analysis Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/learning.html">Learning Theory Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/representations.html">Representations Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/operations.html">Function Operations Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/families.html">Function Families and Growth Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/probabilistic.html">Probabilistic View &amp; Pseudorandomness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/advanced.html">Advanced Topics Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/migration_from_tal.html">Migration from Tal’s BooleanFunc.py</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../comparison_guide.html">Library Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../performance.html">Performance Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../error_handling.html">Error Handling in BooFun</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cross_validation.html">Cross-Validation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../CONTRIBUTING.html">Contributing to BooFun</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../STYLE_GUIDE.html">BooFun Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../TEST_GUIDELINES.html">Test Guidelines</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/boofun.html">boofun</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">BooFun</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../boofun.html">boofun</a></li>
      <li class="breadcrumb-item active">boofun.utils.number_theory</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for boofun.utils.number_theory</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Number theory helpers with optional SymPy support.</span>

<span class="sd">This module provides essential number theory utilities for Boolean function</span>
<span class="sd">analysis, including:</span>
<span class="sd">- Prime factorization and testing</span>
<span class="sd">- Euler&#39;s totient function</span>
<span class="sd">- Binomial coefficients</span>
<span class="sd">- Modular arithmetic (GCD, CRT, modular inverse)</span>
<span class="sd">- Prime sieving</span>

<span class="sd">Many algorithms in Boolean function analysis require these primitives,</span>
<span class="sd">particularly for analyzing function structure and cryptographic properties.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">gcd</span> <span class="k">as</span> <span class="n">_gcd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="k">try</span><span class="p">:</span>  <span class="c1"># pragma: no cover - optional dependency</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_sp</span>

    <span class="n">_HAS_SYMPY</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="n">_sp</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_HAS_SYMPY</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Basic operations</span>
    <span class="s2">&quot;gcd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;invmod&quot;</span><span class="p">,</span>
    <span class="s2">&quot;crt&quot;</span><span class="p">,</span>
    <span class="c1"># Prime testing and factorization</span>
    <span class="s2">&quot;is_prime&quot;</span><span class="p">,</span>
    <span class="s2">&quot;prime_sieve&quot;</span><span class="p">,</span>
    <span class="s2">&quot;factor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;prime_factorization&quot;</span><span class="p">,</span>
    <span class="c1"># Euler&#39;s totient</span>
    <span class="s2">&quot;euler_phi&quot;</span><span class="p">,</span>
    <span class="s2">&quot;totient&quot;</span><span class="p">,</span>
    <span class="c1"># Binomial coefficients</span>
    <span class="s2">&quot;binomial&quot;</span><span class="p">,</span>
    <span class="s2">&quot;binomial_sum&quot;</span><span class="p">,</span>
    <span class="c1"># Utility functions</span>
    <span class="s2">&quot;lcm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mobius&quot;</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="gcd">
<a class="viewcode-back" href="../../../api/boofun.utils.number_theory.html#boofun.utils.gcd">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Greatest common divisor via math.gcd.&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">_gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></div>



<div class="viewcode-block" id="invmod">
<a class="viewcode-back" href="../../../api/boofun.utils.number_theory.html#boofun.utils.invmod">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">invmod</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Modular inverse of *a* modulo *m* (raises ValueError if none).&quot;&quot;&quot;</span>

    <span class="n">a</span> <span class="o">%=</span> <span class="n">m</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">new_t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">new_r</span> <span class="o">=</span> <span class="n">m</span><span class="p">,</span> <span class="n">a</span>
        <span class="k">while</span> <span class="n">new_r</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">r</span> <span class="o">//</span> <span class="n">new_r</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">new_t</span> <span class="o">=</span> <span class="n">new_t</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">new_t</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">new_r</span> <span class="o">=</span> <span class="n">new_r</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">new_r</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;inverse does not exist&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">m</span>
        <span class="k">return</span> <span class="n">t</span></div>



<div class="viewcode-block" id="crt">
<a class="viewcode-back" href="../../../api/boofun.utils.number_theory.html#boofun.utils.crt">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">crt</span><span class="p">(</span><span class="n">moduli</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">residues</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chinese Remainder Theorem solution (value, modulus).</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no solution exists (e.g., incompatible moduli).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">moduli</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residues</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;moduli and residues must have same length&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_HAS_SYMPY</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">_sp</span><span class="o">.</span><span class="n">ntheory</span><span class="o">.</span><span class="n">modular</span><span class="o">.</span><span class="n">crt</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">moduli</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">residues</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;no solution&quot;</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="n">M</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">moduli</span><span class="p">,</span> <span class="n">residues</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">_gcd</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="n">d</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;no solution&quot;</span><span class="p">)</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">m</span> <span class="o">//</span> <span class="n">d</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">//</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">invmod</span><span class="p">(</span><span class="n">M</span> <span class="o">//</span> <span class="n">d</span><span class="p">,</span> <span class="n">m1</span><span class="p">)</span> <span class="o">%</span> <span class="n">m1</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">M</span> <span class="o">*</span> <span class="n">t</span>
        <span class="n">M</span> <span class="o">*=</span> <span class="n">m1</span>
        <span class="n">x</span> <span class="o">%=</span> <span class="n">M</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">M</span></div>



<div class="viewcode-block" id="is_prime">
<a class="viewcode-back" href="../../../api/boofun.utils.number_theory.html#boofun.utils.is_prime">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_prime</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deterministic primality for 64-bit *n* (SymPy-backed if available).&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">_HAS_SYMPY</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_sp</span><span class="o">.</span><span class="n">ntheory</span><span class="o">.</span><span class="n">primetest</span><span class="o">.</span><span class="n">isprime</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">d</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">//=</span> <span class="mi">2</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">%</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="prime_sieve">
<a class="viewcode-back" href="../../../api/boofun.utils.number_theory.html#boofun.utils.prime_sieve">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">prime_sieve</span><span class="p">(</span><span class="n">upto</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return primes &lt;= *upto* via a simple Sieve of Eratosthenes.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">upto</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">sieve</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x01</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">upto</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">sieve</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">p</span> <span class="o">*</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">upto</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sieve</span><span class="p">[</span><span class="n">p</span><span class="p">]:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">p</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">p</span>
            <span class="n">sieve</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">upto</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="p">(((</span><span class="n">upto</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">//</span> <span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sieve</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="p">]</span></div>



<div class="viewcode-block" id="factor">
<a class="viewcode-back" href="../../../api/boofun.utils.number_theory.html#boofun.utils.factor">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return prime factorization of n as a list of prime factors (with multiplicity).</span>

<span class="sd">    Args:</span>
<span class="sd">        n: Positive integer to factor</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of prime factors in ascending order</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; factor(60)</span>
<span class="sd">        [2, 2, 3, 5]</span>
<span class="sd">        &gt;&gt;&gt; factor(17)</span>
<span class="sd">        [17]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">_HAS_SYMPY</span><span class="p">:</span>
        <span class="k">pass</span>

        <span class="n">factorization</span> <span class="o">=</span> <span class="n">_sp</span><span class="o">.</span><span class="n">ntheory</span><span class="o">.</span><span class="n">factorint</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">exp</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">factorization</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">factors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">n</span>

    <span class="c1"># Handle factor of 2</span>
    <span class="k">while</span> <span class="n">tmp</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">//=</span> <span class="mi">2</span>

    <span class="c1"># Handle odd factors</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">while</span> <span class="n">p</span> <span class="o">*</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">tmp</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">tmp</span> <span class="o">%</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">tmp</span> <span class="o">//=</span> <span class="n">p</span>
        <span class="n">p</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">tmp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">factors</span></div>



<div class="viewcode-block" id="prime_factorization">
<a class="viewcode-back" href="../../../api/boofun.utils.number_theory.html#boofun.utils.prime_factorization">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">prime_factorization</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return prime factorization as a dictionary {prime: exponent}.</span>

<span class="sd">    Args:</span>
<span class="sd">        n: Positive integer to factor</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary mapping primes to their exponents</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; prime_factorization(60)</span>
<span class="sd">        {2: 2, 3: 1, 5: 1}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">_HAS_SYMPY</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">_sp</span><span class="o">.</span><span class="n">ntheory</span><span class="o">.</span><span class="n">factorint</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">factor</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="euler_phi">
<a class="viewcode-back" href="../../../api/boofun.utils.number_theory.html#boofun.utils.euler_phi">[docs]</a>
<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">euler_phi</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Euler&#39;s totient function φ(n).</span>

<span class="sd">    φ(n) = count of integers in [1, n] that are coprime to n.</span>

<span class="sd">    Uses the formula: φ(n) = n * ∏_{p|n} (1 - 1/p)</span>

<span class="sd">    Args:</span>
<span class="sd">        n: Positive integer</span>

<span class="sd">    Returns:</span>
<span class="sd">        Euler&#39;s totient of n</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; euler_phi(12)  # 1, 5, 7, 11 are coprime to 12</span>
<span class="sd">        4</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">_HAS_SYMPY</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">_sp</span><span class="o">.</span><span class="n">ntheory</span><span class="o">.</span><span class="n">totient</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="c1"># Get unique prime factors</span>
    <span class="n">primes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">n</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primes</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">result</span></div>



<span class="c1"># Alias for euler_phi</span>
<span class="n">totient</span> <span class="o">=</span> <span class="n">euler_phi</span>


<div class="viewcode-block" id="binomial">
<a class="viewcode-back" href="../../../api/boofun.utils.number_theory.html#boofun.utils.binomial">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">binomial</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute binomial coefficient C(n, k) = n! / (k! * (n-k)!).</span>

<span class="sd">    Uses iterative computation to avoid large intermediate values.</span>

<span class="sd">    Args:</span>
<span class="sd">        n: Total items</span>
<span class="sd">        k: Items to choose</span>

<span class="sd">    Returns:</span>
<span class="sd">        Number of ways to choose k items from n</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; binomial(5, 2)</span>
<span class="sd">        10</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="c1"># Use symmetry: C(n,k) = C(n, n-k)</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span>

    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="binomial_sum">
<a class="viewcode-back" href="../../../api/boofun.utils.number_theory.html#boofun.utils.binomial_sum">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">binomial_sum</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute sum of binomial coefficients: Σ_{i=0}^{k} C(n, i).</span>

<span class="sd">    This is useful for counting functions of low degree.</span>

<span class="sd">    Args:</span>
<span class="sd">        n: Total items</span>
<span class="sd">        k: Maximum selection size</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sum of C(n,0) + C(n,1) + ... + C(n,k)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; binomial_sum(5, 2)  # C(5,0) + C(5,1) + C(5,2) = 1 + 5 + 10</span>
<span class="sd">        16</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">**</span><span class="n">n</span>

    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">coeff</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">coeff</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total</span></div>



<div class="viewcode-block" id="lcm">
<a class="viewcode-back" href="../../../api/boofun.utils.number_theory.html#boofun.utils.lcm">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">lcm</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute least common multiple of a and b.</span>

<span class="sd">    Args:</span>
<span class="sd">        a, b: Integers</span>

<span class="sd">    Returns:</span>
<span class="sd">        LCM(a, b)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">//</span> <span class="n">_gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></div>



<div class="viewcode-block" id="mobius">
<a class="viewcode-back" href="../../../api/boofun.utils.number_theory.html#boofun.utils.mobius">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mobius</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the Möbius function μ(n).</span>

<span class="sd">    μ(n) = 0 if n has a squared prime factor</span>
<span class="sd">    μ(n) = (-1)^k if n is a product of k distinct primes</span>
<span class="sd">    μ(1) = 1</span>

<span class="sd">    The Möbius function is important in combinatorics and number theory,</span>
<span class="sd">    particularly for Möbius inversion.</span>

<span class="sd">    Args:</span>
<span class="sd">        n: Positive integer</span>

<span class="sd">    Returns:</span>
<span class="sd">        μ(n) ∈ {-1, 0, 1}</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; mobius(1)</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; mobius(6)  # 6 = 2 * 3, two distinct primes</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; mobius(12)  # 12 = 2^2 * 3, has squared factor</span>
<span class="sd">        0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">_HAS_SYMPY</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">_sp</span><span class="o">.</span><span class="n">ntheory</span><span class="o">.</span><span class="n">mobius</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="n">factorization</span> <span class="o">=</span> <span class="n">prime_factorization</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="c1"># Check for squared prime factor</span>
    <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">factorization</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Return (-1)^k where k is number of distinct prime factors</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">factorization</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">k</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024-2026, Gabriel Taboada.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>